# config.json 配置文件说明文档

## 概述

`config.json` 是蓝牙设备检测系统的核心配置文件，用于定义设备连接参数、通信设置和系统行为配置。

## 配置结构

### 1. devices（设备配置数组）

配置多个蓝牙检测设备的连接参数。

```json
"devices": [
  {
    "serialPath": "/dev/ttyUSB0",
    "deviceId": "bluetooth_device_0",
    "baudRate": 115200,
    "enabled": true
  }
]
```

#### 字段说明

- **serialPath** (string): 设备串口路径
  - 示例：`"/dev/ttyUSB0"`, `"/dev/ttyUSB1"`
  - 用途：指定设备连接的物理串口位置

- **deviceId** (string): 设备唯一标识符
  - 示例：`"bluetooth_device_0"`, `"bluetooth_device_1"`
  - 用途：系统内部识别和管理设备的唯一ID

- **baudRate** (number): 串口通信波特率
  - 默认值：`115200`
  - 常用值：9600, 38400, 115200, 230400
  - 用途：设置串口通信速度

- **enabled** (boolean): 设备启用状态
  - `true`: 启用设备
  - `false`: 禁用设备
  - 用途：控制设备是否参与系统运行

### 2. rssi（信号强度阈值）

```json
"rssi": "-53"
```

- **类型**: string
- **默认值**: `"-53"`
- **单位**: dBm
- **用途**: 设置蓝牙检测设备启动扫描时的信号强度过滤阈值，只有信号强度高于此值的设备才会被处理
- **取值范围**: 通常在 -100 到 0 之间，数值越大信号越强

### 3. useConfigRssi（RSSI值来源控制）

```json
"useConfigRssi": true
```

- **类型**: boolean
- **默认值**: `true`
- **用途**: 控制RSSI值的来源策略
  - `true`: 使用配置文件中的rssi值作为信号强度阈值
  - `false`: 使用上位机动态传入的RSSI值，忽略配置文件中的rssi设置
- **应用场景**:
  - 设为`true`时适用于固定阈值的应用场景
  - 设为`false`时适用于需要动态调整信号强度阈值的应用场景

### 4. reportInterval（报告间隔）

```json
"reportInterval": 2000
```

- **类型**: number
- **单位**: 毫秒 (ms)
- **默认值**: `2000` (2秒)
- **用途**: 设置当收到上位机开始上报指令后，单个国外品牌的上报间隔
- **建议值**: 1000-10000ms，根据实际需求调整

### 5. serialTransport（上位机串口传输配置）

主要串口通信参数配置。

```json
"serialTransport": {
  "type": "serial",
  "serialPath": "/dev/ttyS3",
  "baudRate": 115200,
  "dataBits": 8,
  "stopBits": 1,
  "parity": "none",
  "timeout": 5000
}
```

#### 字段说明

- **serialPath** (string): 串口路径
  - 示例：`"/dev/ttyS3"`
  - 用途：指定主要通信串口

- **baudRate** (number): 波特率
  - 默认值：`115200`
  - 用途：串口通信速度

- **dataBits** (number): 数据位
  - 默认值：`8`
  - 常用值：7, 8
  - 用途：每个字符的数据位数

- **stopBits** (number): 停止位
  - 默认值：`1`
  - 常用值：1, 2
  - 用途：字符结束标志位数

- **parity** (string): 校验位
  - 默认值：`"none"`
  - 可选值：`"none"`, `"even"`, `"odd"`
  - 用途：数据传输错误检测

- **timeout** (number): 超时时间
  - 默认值：`5000`
  - 单位：毫秒 (ms)
  - 用途：串口操作超时限制

### 6. logging（日志配置）

系统日志记录相关设置。

```json
"logging": {
  "level": "info",
  "enableDevicePrefix": true,
  "enableTimestamp": true
}
```

#### 字段说明

- **level** (string): 日志级别
  - 可选值：`"debug"`, `"info"`, `"warn"`, `"error"`
  - 默认值：`"info"`
  - 用途：控制日志输出的详细程度

- **enableDevicePrefix** (boolean): 启用设备前缀
  - `true`: 在日志中显示设备标识
  - `false`: 不显示设备标识
  - 用途：便于区分不同设备的日志信息

- **enableTimestamp** (boolean): 启用时间戳
  - `true`: 在日志中显示时间戳
  - `false`: 不显示时间戳
  - 用途：记录事件发生的具体时间

## 配置示例

### 单设备配置

```json
{
  "devices": [
    {
      "serialPath": "/dev/ttyUSB0",
      "deviceId": "main_device",
      "baudRate": 115200,
      "enabled": true
    }
  ],
  "rssi": "-70",
  "useConfigRssi": true,
  "reportInterval": 5000
}
```

### 多设备配置

```json
{
  "devices": [
    {
      "serialPath": "/dev/ttyUSB0",
      "deviceId": "device_1",
      "baudRate": 115200,
      "enabled": true
    },
    {
      "serialPath": "/dev/ttyUSB1",
      "deviceId": "device_2",
      "baudRate": 115200,
      "enabled": true
    }
  ],
  "rssi": "-53",
  "useConfigRssi": true,
  "reportInterval": 6000
}
```

### 完整配置示例

```json
{
  "devices": [
    {
      "serialPath": "/dev/ttyUSB0",
      "deviceId": "bluetooth_device_0",
      "baudRate": 115200,
      "enabled": true
    },
    {
      "serialPath": "/dev/ttyUSB1",
      "deviceId": "bluetooth_device_1",
      "baudRate": 115200,
      "enabled": false
    }
  ],
  "rssi": "-53",
  "useConfigRssi": true,
  "reportInterval": 6000,
  "serialTransport": {
    "serialPath": "/dev/ttyS3",
    "baudRate": 115200,
    "dataBits": 8,
    "stopBits": 1,
    "parity": "none",
    "timeout": 5000
  },
  "logging": {
    "level": "info",
    "enableDevicePrefix": true,
    "enableTimestamp": true
  }
}
```

## 注意事项

1. **串口路径**: 确保指定的串口路径存在且有访问权限
2. **设备ID唯一性**: 每个设备的 `deviceId` 必须唯一
3. **波特率匹配**: 确保配置的波特率与硬件设备匹配
4. **权限要求**: 运行程序的用户需要有串口访问权限
5. **配置验证**: 修改配置后建议先测试连接是否正常
6. **RSSI策略**: 根据应用场景合理设置 `useConfigRssi`，固定阈值场景使用配置文件值，动态调整场景使用上位机传入值

## 故障排除

- **设备连接失败**: 检查串口路径和权限设置
- **通信异常**: 验证波特率和串口参数配置
- **设备未响应**: 确认设备已启用且硬件连接正常
- **日志过多**: 调整日志级别到 `"warn"` 或 `"error"`

## 版本兼容性

此配置文件格式适用于当前版本的蓝牙设备管理系统。升级系统时请注意配置文件格式的变化。
