{"version":3,"sources":["../test.ts"],"sourcesContent":["#!/usr/bin/env ts-node\nimport type { AxiosError } from 'axios'\nimport type { ErrorEvent } from 'eventsource'\nimport process from 'process'\nimport axios from 'axios'\nimport { EventSource } from 'eventsource'\nimport yargs from 'yargs'\nimport { hideBin } from 'yargs/helpers'\n\nconst BASE_URL = 'http://localhost:8888'\n\n// ÂëΩ‰ª§Á†Å (‰∏é src/communication.ts ‰∏ÄËá¥)\nconst CommandCode = {\n  START: 1,\n  HEARTBEAT: 2,\n  STOP: 3,\n}\n\nasync function sendCommand(command: number, data = {}) {\n  try {\n    const response = await axios.post(`${BASE_URL}/command`, {\n      c: command,\n      d: data,\n    })\n    console.log('‚úÖ  Response:')\n    console.log(response.data)\n  }\n  catch (error: any) {\n    console.error('‚ùå  ËØ∑Ê±ÇÂ§±Ë¥•:')\n    if (axios.isAxiosError(error)) {\n      const axiosError = error as AxiosError\n      if (axiosError.response) {\n        // ÊúçÂä°Âô®ËøîÂõû‰∫ÜÈîôËØØÁä∂ÊÄÅÁ†Å\n        console.error(`  - Áä∂ÊÄÅÁ†Å: ${axiosError.response.status}`)\n        console.error('  - ÂìçÂ∫îÊï∞ÊçÆ:', axiosError.response.data)\n      }\n      else if (axiosError.request) {\n        // ËØ∑Ê±ÇÂ∑≤ÂèëÂá∫Ôºå‰ΩÜÊ≤°ÊúâÊî∂Âà∞ÂìçÂ∫î\n        console.error('  - ÈîôËØØ: Êú™Êî∂Âà∞ÊúçÂä°Âô®ÂìçÂ∫î„ÄÇ')\n        console.error('  - ÊèêÁ§∫: ËØ∑Á°ÆËÆ§‰∏ªÁ®ãÂ∫è (src/index.ts) ÊòØÂê¶Â∑≤Âú®ËøêË°åÔºåÂπ∂‰∏îÁõëÂê¨ÁöÑÂú∞ÂùÄÂíåÁ´ØÂè£Ê≠£Á°Æ„ÄÇ')\n      }\n      else {\n        // ËÆæÁΩÆËØ∑Ê±ÇÊó∂ÂèëÁîüÈîôËØØ\n        console.error('  - ÈîôËØØ: ËØ∑Ê±ÇËÆæÁΩÆÂ§±Ë¥•„ÄÇ')\n        console.error('  - ËØ¶ÊÉÖ:', axiosError.message)\n      }\n    }\n    else {\n      // ÂÖ∂‰ªñÊú™Áü•ÈîôËØØ\n      console.error('  - ÂèëÁîüÊú™Áü•ÈîôËØØ:', error.message || error)\n    }\n  }\n}\n\nyargs(hideBin(process.argv))\n  .scriptName('test-client')\n  .command(\n    'heartbeat',\n    'Send heartbeat command',\n    () => {},\n    async () => {\n      console.log('Sending [heartbeat] command...')\n      await sendCommand(CommandCode.HEARTBEAT)\n    },\n  )\n  .command(\n    'start',\n    'Send start scan command',\n    () => {},\n    async () => {\n      console.log('Sending [start] command...')\n      await sendCommand(CommandCode.START)\n    },\n  )\n  .command(\n    'stop',\n    'Send stop scan command',\n    () => {},\n    async () => {\n      console.log('Sending [stop] command...')\n      await sendCommand(CommandCode.STOP)\n    },\n  )\n  .command(\n    'listen',\n    'Listen for device events from the server',\n    () => {},\n    () => {\n      console.log('Listening for events from server...')\n      const es = new EventSource(`${BASE_URL}/events`)\n      es.onmessage = (event: MessageEvent) => {\n        console.log('üì©  Received event:')\n        console.log(JSON.parse(event.data))\n      }\n      es.onerror = (err: ErrorEvent) => {\n        if (err.type === 'error' && (err as any).status === 404) {\n          console.error('‚ùå Êâæ‰∏çÂà∞ÊúçÂä°Âô®„ÄÇ‰∏ªÂ∫îÁî®Á®ãÂ∫è (src/index.ts) ÊòØÂê¶Ê≠£Âú®ËøêË°åÔºü')\n        }\n        else {\n          console.error('‚ùå EventSource ÈîôËØØ:', err)\n        }\n        es.close()\n      }\n    },\n  )\n  .demandCommand(1, 'You need at least one command before moving on')\n  .help()\n  .parse()\n"],"mappings":";;;AAGA,OAAO,aAAa;AACpB,OAAO,WAAW;AAClB,SAAS,mBAAmB;AAC5B,OAAO,WAAW;AAClB,SAAS,eAAe;AAExB,IAAM,WAAW;AAGjB,IAAM,cAAc;AAAA,EAClB,OAAO;AAAA,EACP,WAAW;AAAA,EACX,MAAM;AACR;AAEA,eAAe,YAAY,SAAiB,OAAO,CAAC,GAAG;AACrD,MAAI;AACF,UAAM,WAAW,MAAM,MAAM,KAAK,GAAG,QAAQ,YAAY;AAAA,MACvD,GAAG;AAAA,MACH,GAAG;AAAA,IACL,CAAC;AACD,YAAQ,IAAI,mBAAc;AAC1B,YAAQ,IAAI,SAAS,IAAI;AAAA,EAC3B,SACO,OAAY;AACjB,YAAQ,MAAM,mCAAU;AACxB,QAAI,MAAM,aAAa,KAAK,GAAG;AAC7B,YAAM,aAAa;AACnB,UAAI,WAAW,UAAU;AAEvB,gBAAQ,MAAM,2BAAY,WAAW,SAAS,MAAM,EAAE;AACtD,gBAAQ,MAAM,iCAAa,WAAW,SAAS,IAAI;AAAA,MACrD,WACS,WAAW,SAAS;AAE3B,gBAAQ,MAAM,0EAAmB;AACjC,gBAAQ,MAAM,gMAAoD;AAAA,MACpE,OACK;AAEH,gBAAQ,MAAM,8DAAiB;AAC/B,gBAAQ,MAAM,qBAAW,WAAW,OAAO;AAAA,MAC7C;AAAA,IACF,OACK;AAEH,cAAQ,MAAM,6CAAe,MAAM,WAAW,KAAK;AAAA,IACrD;AAAA,EACF;AACF;AAEA,MAAM,QAAQ,QAAQ,IAAI,CAAC,EACxB,WAAW,aAAa,EACxB;AAAA,EACC;AAAA,EACA;AAAA,EACA,MAAM;AAAA,EAAC;AAAA,EACP,YAAY;AACV,YAAQ,IAAI,gCAAgC;AAC5C,UAAM,YAAY,YAAY,SAAS;AAAA,EACzC;AACF,EACC;AAAA,EACC;AAAA,EACA;AAAA,EACA,MAAM;AAAA,EAAC;AAAA,EACP,YAAY;AACV,YAAQ,IAAI,4BAA4B;AACxC,UAAM,YAAY,YAAY,KAAK;AAAA,EACrC;AACF,EACC;AAAA,EACC;AAAA,EACA;AAAA,EACA,MAAM;AAAA,EAAC;AAAA,EACP,YAAY;AACV,YAAQ,IAAI,2BAA2B;AACvC,UAAM,YAAY,YAAY,IAAI;AAAA,EACpC;AACF,EACC;AAAA,EACC;AAAA,EACA;AAAA,EACA,MAAM;AAAA,EAAC;AAAA,EACP,MAAM;AACJ,YAAQ,IAAI,qCAAqC;AACjD,UAAM,KAAK,IAAI,YAAY,GAAG,QAAQ,SAAS;AAC/C,OAAG,YAAY,CAAC,UAAwB;AACtC,cAAQ,IAAI,4BAAqB;AACjC,cAAQ,IAAI,KAAK,MAAM,MAAM,IAAI,CAAC;AAAA,IACpC;AACA,OAAG,UAAU,CAAC,QAAoB;AAChC,UAAI,IAAI,SAAS,WAAY,IAAY,WAAW,KAAK;AACvD,gBAAQ,MAAM,2IAAuC;AAAA,MACvD,OACK;AACH,gBAAQ,MAAM,oCAAqB,GAAG;AAAA,MACxC;AACA,SAAG,MAAM;AAAA,IACX;AAAA,EACF;AACF,EACC,cAAc,GAAG,gDAAgD,EACjE,KAAK,EACL,MAAM;","names":[]}